from pathlib import Path


BASE = Path(__file__).resolve().parents[1]

REMAINING_TRANSLATIONS = {
    'zh_Hant': {
        'Priority': '優先級',
        'normal': '一般',
        'urgent': '緊急',
        'emergency': '特急',
        'Init': '初始化',
        '(select a content-type)': '（選擇內容類型）',
        'content type': '內容類型',
        'history': '歷史',
        'comment': '備註',
        'simulation model %s': '模擬模型 %s',
        'Simulation object': '模擬物件',
        'category': '分類',
        'file': '檔案',
        'Image': '圖片',
        'catagory': '分類',
        'Icon': '圖示',
        'action': '動作',
        'label': '標籤',
        'icon': '圖示',
        'Image Button': '圖像按鈕',
        'Add %(name)s': '新增 %(name)s',
        'Home': '首頁',
        'Add': '新增',
        'History': '歷史',
        'View on site': '在站點中查看',
        'Filter': '篩選',
        'the save method of the form must accept parameters user and data': '表單的 save 方法必須接受 user 和 data 參數',
        'forme save error: %s': '表單儲存錯誤：%s',
        '<h1>Update Icons from Images</h1>': '<h1>從圖片更新圖示</h1>',
        '<br> %s added ': '<br> 已新增 %s ',
        '<hr><p><b><a href=../>return</a></b>': '<hr><p><b><a href=../>返回</a></b>',
        'Ordering': '排序',
        'Order:': '順序：',
        'Django administration': 'Django 管理介面',
        'Models available in the %(name)s application.': '%(name)s 應用中可用的模型。',
        '%(name)s': '%(name)s',
        'Change': '修改',
        "You don't have permission to edit anything.": '你沒有編輯任何內容的權限。',
        'Workflows': '流程',
        'Recent Actions': '最近操作',
        'My Actions': '我的操作',
        'None available': '無可用項目',
        'SLA': '服務等級協議',
        'GoFlow': 'GoFlow',
    },
    'ja': {
        'Priority': '優先度',
        'normal': '通常',
        'urgent': '緊急',
        'emergency': '至急',
        'Init': '初期化',
        '(select a content-type)': '（コンテンツタイプを選択）',
        'content type': 'コンテンツタイプ',
        'history': '履歴',
        'comment': 'コメント',
        'simulation model %s': 'シミュレーションモデル %s',
        'Simulation object': 'シミュレーションオブジェクト',
        'category': 'カテゴリ',
        'file': 'ファイル',
        'Image': '画像',
        'catagory': 'カテゴリ',
        'Icon': 'アイコン',
        'action': 'アクション',
        'label': 'ラベル',
        'icon': 'アイコン',
        'Image Button': '画像ボタン',
        'Add %(name)s': '%(name)s を追加',
        'Home': 'ホーム',
        'Add': '追加',
        'History': '履歴',
        'View on site': 'サイトで表示',
        'Filter': 'フィルター',
        'the save method of the form must accept parameters user and data': 'フォームの save メソッドは user と data パラメータを受け取る必要があります',
        'forme save error: %s': 'フォーム保存エラー: %s',
        '<h1>Update Icons from Images</h1>': '<h1>画像からアイコンを更新</h1>',
        '<br> %s added ': '<br> %s を追加しました ',
        '<hr><p><b><a href=../>return</a></b>': '<hr><p><b><a href=../>戻る</a></b>',
        'Ordering': '並び順',
        'Order:': '順序:',
        'Django administration': 'Django 管理',
        'Models available in the %(name)s application.': '%(name)s アプリで利用可能なモデル。',
        '%(name)s': '%(name)s',
        'Change': '変更',
        "You don't have permission to edit anything.": '編集する権限がありません。',
        'Workflows': 'ワークフロー',
        'Recent Actions': '最近の操作',
        'My Actions': '自分の操作',
        'None available': '利用可能なものはありません',
        'SLA': 'SLA',
        'GoFlow': 'GoFlow',
    },
    'ko': {
        'Priority': '우선순위',
        'normal': '보통',
        'urgent': '긴급',
        'emergency': '비상',
        'Init': '초기화',
        '(select a content-type)': '(콘텐츠 유형 선택)',
        'content type': '콘텐츠 유형',
        'history': '이력',
        'comment': '코멘트',
        'simulation model %s': '시뮬레이션 모델 %s',
        'Simulation object': '시뮬레이션 객체',
        'category': '카테고리',
        'file': '파일',
        'Image': '이미지',
        'catagory': '카테고리',
        'Icon': '아이콘',
        'action': '동작',
        'label': '라벨',
        'icon': '아이콘',
        'Image Button': '이미지 버튼',
        'Add %(name)s': '%(name)s 추가',
        'Home': '홈',
        'Add': '추가',
        'History': '이력',
        'View on site': '사이트에서 보기',
        'Filter': '필터',
        'the save method of the form must accept parameters user and data': '폼의 save 메서드는 user 및 data 매개변수를 받아야 합니다',
        'forme save error: %s': '폼 저장 오류: %s',
        '<h1>Update Icons from Images</h1>': '<h1>이미지에서 아이콘 업데이트</h1>',
        '<br> %s added ': '<br> %s 추가됨 ',
        '<hr><p><b><a href=../>return</a></b>': '<hr><p><b><a href=../>돌아가기</a></b>',
        'Ordering': '정렬',
        'Order:': '순서:',
        'Django administration': 'Django 관리',
        'Models available in the %(name)s application.': '%(name)s 애플리케이션에서 사용 가능한 모델.',
        '%(name)s': '%(name)s',
        'Change': '변경',
        "You don't have permission to edit anything.": '편집 권한이 없습니다.',
        'Workflows': '워크플로',
        'Recent Actions': '최근 작업',
        'My Actions': '내 작업',
        'None available': '사용 가능한 항목 없음',
        'SLA': 'SLA',
        'GoFlow': 'GoFlow',
    },
    'fr': {
        'Priority': 'Priorité',
        'normal': 'normal',
        'urgent': 'urgent',
        'emergency': 'urgence',
        'Init': 'Initialiser',
        '(select a content-type)': '(sélectionner un type de contenu)',
        'content type': 'type de contenu',
        'history': 'historique',
        'comment': 'commentaire',
        'simulation model %s': 'modèle de simulation %s',
        'Simulation object': 'Objet de simulation',
        'category': 'catégorie',
        'file': 'fichier',
        'Image': 'Image',
        'catagory': 'catégorie',
        'Icon': 'Icône',
        'action': 'action',
        'label': 'libellé',
        'icon': 'icône',
        'Image Button': 'Bouton image',
        'Add %(name)s': 'Ajouter %(name)s',
        'Home': 'Accueil',
        'Add': 'Ajouter',
        'History': 'Historique',
        'View on site': 'Voir sur le site',
        'Filter': 'Filtrer',
        'the save method of the form must accept parameters user and data': 'la méthode save du formulaire doit accepter les paramètres user et data',
        'forme save error: %s': 'erreur d’enregistrement du formulaire : %s',
        '<h1>Update Icons from Images</h1>': '<h1>Mettre à jour les icônes à partir des images</h1>',
        '<br> %s added ': '<br> %s ajouté ',
        '<hr><p><b><a href=../>return</a></b>': '<hr><p><b><a href=../>retour</a></b>',
        'Ordering': 'Ordre',
        'Order:': 'Ordre :',
        'Django administration': 'Administration Django',
        'Models available in the %(name)s application.': 'Modèles disponibles dans l’application %(name)s.',
        '%(name)s': '%(name)s',
        'Change': 'Modifier',
        "You don't have permission to edit anything.": 'Vous n’avez la permission de rien modifier.',
        'Workflows': 'Workflows',
        'Recent Actions': 'Actions récentes',
        'My Actions': 'Mes actions',
        'None available': 'Aucun disponible',
        'SLA': 'SLA',
        'GoFlow': 'GoFlow',
    },
    'de': {
        'Priority': 'Priorität',
        'normal': 'normal',
        'urgent': 'dringend',
        'emergency': 'Notfall',
        'Init': 'Initialisieren',
        '(select a content-type)': '(Inhaltstyp auswählen)',
        'content type': 'Inhaltstyp',
        'history': 'Verlauf',
        'comment': 'Kommentar',
        'simulation model %s': 'Simulationsmodell %s',
        'Simulation object': 'Simulationsobjekt',
        'category': 'Kategorie',
        'file': 'Datei',
        'Image': 'Bild',
        'catagory': 'Kategorie',
        'Icon': 'Symbol',
        'action': 'Aktion',
        'label': 'Bezeichnung',
        'icon': 'Symbol',
        'Image Button': 'Bildschaltfläche',
        'Add %(name)s': '%(name)s hinzufügen',
        'Home': 'Startseite',
        'Add': 'Hinzufügen',
        'History': 'Verlauf',
        'View on site': 'Auf der Website anzeigen',
        'Filter': 'Filter',
        'the save method of the form must accept parameters user and data': 'die save-Methode des Formulars muss die Parameter user und data akzeptieren',
        'forme save error: %s': 'Formularspeicherfehler: %s',
        '<h1>Update Icons from Images</h1>': '<h1>Symbole aus Bildern aktualisieren</h1>',
        '<br> %s added ': '<br> %s hinzugefügt ',
        '<hr><p><b><a href=../>return</a></b>': '<hr><p><b><a href=../>zurück</a></b>',
        'Ordering': 'Sortierung',
        'Order:': 'Reihenfolge:',
        'Django administration': 'Django-Administration',
        'Models available in the %(name)s application.': 'Modelle verfügbar in der Anwendung %(name)s.',
        '%(name)s': '%(name)s',
        'Change': 'Ändern',
        "You don't have permission to edit anything.": 'Sie haben keine Berechtigung, etwas zu bearbeiten.',
        'Workflows': 'Workflows',
        'Recent Actions': 'Letzte Aktionen',
        'My Actions': 'Meine Aktionen',
        'None available': 'Nichts verfügbar',
        'SLA': 'SLA',
        'GoFlow': 'GoFlow',
    },
    'it': {
        'Priority': 'Priorità',
        'normal': 'normale',
        'urgent': 'urgente',
        'emergency': 'emergenza',
        'Init': 'Inizializza',
        '(select a content-type)': '(seleziona un tipo di contenuto)',
        'content type': 'tipo di contenuto',
        'history': 'storico',
        'comment': 'commento',
        'simulation model %s': 'modello di simulazione %s',
        'Simulation object': 'Oggetto di simulazione',
        'category': 'categoria',
        'file': 'file',
        'Image': 'Immagine',
        'catagory': 'categoria',
        'Icon': 'Icona',
        'action': 'azione',
        'label': 'etichetta',
        'icon': 'icona',
        'Image Button': 'Pulsante immagine',
        'Add %(name)s': 'Aggiungi %(name)s',
        'Home': 'Home',
        'Add': 'Aggiungi',
        'History': 'Storico',
        'View on site': 'Visualizza sul sito',
        'Filter': 'Filtro',
        'the save method of the form must accept parameters user and data': 'il metodo save del form deve accettare i parametri user e data',
        'forme save error: %s': 'errore di salvataggio form: %s',
        '<h1>Update Icons from Images</h1>': '<h1>Aggiorna icone da immagini</h1>',
        '<br> %s added ': '<br> %s aggiunto ',
        '<hr><p><b><a href=../>return</a></b>': '<hr><p><b><a href=../>ritorna</a></b>',
        'Ordering': 'Ordinamento',
        'Order:': 'Ordine:',
        'Django administration': 'Amministrazione Django',
        'Models available in the %(name)s application.': 'Modelli disponibili nell’applicazione %(name)s.',
        '%(name)s': '%(name)s',
        'Change': 'Modifica',
        "You don't have permission to edit anything.": 'Non hai i permessi per modificare nulla.',
        'Workflows': 'Workflow',
        'Recent Actions': 'Azioni recenti',
        'My Actions': 'Le mie azioni',
        'None available': 'Nessuno disponibile',
        'SLA': 'SLA',
        'GoFlow': 'GoFlow',
    },
    'es': {
        'Priority': 'Prioridad',
        'normal': 'normal',
        'urgent': 'urgente',
        'emergency': 'emergencia',
        'Init': 'Inicializar',
        '(select a content-type)': '(seleccionar un tipo de contenido)',
        'content type': 'tipo de contenido',
        'history': 'historial',
        'comment': 'comentario',
        'simulation model %s': 'modelo de simulación %s',
        'Simulation object': 'Objeto de simulación',
        'category': 'categoría',
        'file': 'archivo',
        'Image': 'Imagen',
        'catagory': 'categoría',
        'Icon': 'Icono',
        'action': 'acción',
        'label': 'etiqueta',
        'icon': 'icono',
        'Image Button': 'Botón de imagen',
        'Add %(name)s': 'Agregar %(name)s',
        'Home': 'Inicio',
        'Add': 'Agregar',
        'History': 'Historial',
        'View on site': 'Ver en el sitio',
        'Filter': 'Filtrar',
        'the save method of the form must accept parameters user and data': 'el método save del formulario debe aceptar los parámetros user y data',
        'forme save error: %s': 'error al guardar formulario: %s',
        '<h1>Update Icons from Images</h1>': '<h1>Actualizar iconos desde imágenes</h1>',
        '<br> %s added ': '<br> %s agregado ',
        '<hr><p><b><a href=../>return</a></b>': '<hr><p><b><a href=../>volver</a></b>',
        'Ordering': 'Ordenación',
        'Order:': 'Orden:',
        'Django administration': 'Administración de Django',
        'Models available in the %(name)s application.': 'Modelos disponibles en la aplicación %(name)s.',
        '%(name)s': '%(name)s',
        'Change': 'Cambiar',
        "You don't have permission to edit anything.": 'No tienes permiso para editar nada.',
        'Workflows': 'Flujos de trabajo',
        'Recent Actions': 'Acciones recientes',
        'My Actions': 'Mis acciones',
        'None available': 'Ninguno disponible',
        'SLA': 'SLA',
        'GoFlow': 'GoFlow',
    },
    'pt': {
        'Priority': 'Prioridade',
        'normal': 'normal',
        'urgent': 'urgente',
        'emergency': 'emergência',
        'Init': 'Inicializar',
        '(select a content-type)': '(selecione um tipo de conteúdo)',
        'content type': 'tipo de conteúdo',
        'history': 'histórico',
        'comment': 'comentário',
        'simulation model %s': 'modelo de simulação %s',
        'Simulation object': 'Objeto de simulação',
        'category': 'categoria',
        'file': 'arquivo',
        'Image': 'Imagem',
        'catagory': 'categoria',
        'Icon': 'Ícone',
        'action': 'ação',
        'label': 'rótulo',
        'icon': 'ícone',
        'Image Button': 'Botão de imagem',
        'Add %(name)s': 'Adicionar %(name)s',
        'Home': 'Início',
        'Add': 'Adicionar',
        'History': 'Histórico',
        'View on site': 'Ver no site',
        'Filter': 'Filtro',
        'the save method of the form must accept parameters user and data': 'o método save do formulário deve aceitar os parâmetros user e data',
        'forme save error: %s': 'erro ao salvar formulário: %s',
        '<h1>Update Icons from Images</h1>': '<h1>Atualizar ícones a partir de imagens</h1>',
        '<br> %s added ': '<br> %s adicionado ',
        '<hr><p><b><a href=../>return</a></b>': '<hr><p><b><a href=../>voltar</a></b>',
        'Ordering': 'Ordenação',
        'Order:': 'Ordem:',
        'Django administration': 'Administração do Django',
        'Models available in the %(name)s application.': 'Modelos disponíveis na aplicação %(name)s.',
        '%(name)s': '%(name)s',
        'Change': 'Alterar',
        "You don't have permission to edit anything.": 'Você não tem permissão para editar nada.',
        'Workflows': 'Workflows',
        'Recent Actions': 'Ações recentes',
        'My Actions': 'Minhas ações',
        'None available': 'Nenhum disponível',
        'SLA': 'SLA',
        'GoFlow': 'GoFlow',
    },
    'ru': {
        'Priority': 'Приоритет',
        'normal': 'обычный',
        'urgent': 'срочный',
        'emergency': 'экстренный',
        'Init': 'Инициализация',
        '(select a content-type)': '(выберите тип контента)',
        'content type': 'тип контента',
        'history': 'история',
        'comment': 'комментарий',
        'simulation model %s': 'модель симуляции %s',
        'Simulation object': 'Объект симуляции',
        'category': 'категория',
        'file': 'файл',
        'Image': 'Изображение',
        'catagory': 'категория',
        'Icon': 'Иконка',
        'action': 'действие',
        'label': 'метка',
        'icon': 'иконка',
        'Image Button': 'Кнопка изображения',
        'Add %(name)s': 'Добавить %(name)s',
        'Home': 'Главная',
        'Add': 'Добавить',
        'History': 'История',
        'View on site': 'Открыть на сайте',
        'Filter': 'Фильтр',
        'the save method of the form must accept parameters user and data': 'метод save формы должен принимать параметры user и data',
        'forme save error: %s': 'ошибка сохранения формы: %s',
        '<h1>Update Icons from Images</h1>': '<h1>Обновить иконки из изображений</h1>',
        '<br> %s added ': '<br> добавлено %s ',
        '<hr><p><b><a href=../>return</a></b>': '<hr><p><b><a href=../>назад</a></b>',
        'Ordering': 'Сортировка',
        'Order:': 'Порядок:',
        'Django administration': 'Администрирование Django',
        'Models available in the %(name)s application.': 'Модели, доступные в приложении %(name)s.',
        '%(name)s': '%(name)s',
        'Change': 'Изменить',
        "You don't have permission to edit anything.": 'У вас нет прав на редактирование.',
        'Workflows': 'Workflows',
        'Recent Actions': 'Последние действия',
        'My Actions': 'Мои действия',
        'None available': 'Недоступно',
        'SLA': 'SLA',
        'GoFlow': 'GoFlow',
    },
}


def unquote(value: str) -> str:
    value = value.strip()
    if not (value.startswith('"') and value.endswith('"')):
        return ''
    return bytes(value[1:-1], 'utf-8').decode('unicode_escape')


def quote(value: str) -> str:
    escaped = value.replace('\\', '\\\\').replace('"', '\\"').replace('\n', '\\n')
    return f'"{escaped}"'


def apply_translations(po_path: Path, mapping: dict[str, str]) -> int:
    lines = po_path.read_text(encoding='utf-8', errors='ignore').splitlines()
    changed = 0
    i = 0
    while i < len(lines):
        if lines[i].startswith('msgid ""'):
            i += 1
            continue
        if not lines[i].startswith('msgid '):
            i += 1
            continue

        msgid = unquote(lines[i][6:])
        j = i + 1
        while j < len(lines) and lines[j].startswith('"'):
            msgid += unquote(lines[j])
            j += 1

        if msgid in mapping and j < len(lines) and lines[j].startswith('msgstr '):
            start = j
            j += 1
            while j < len(lines) and lines[j].startswith('"'):
                j += 1
            new_line = 'msgstr ' + quote(mapping[msgid])
            if lines[start:j] != [new_line]:
                lines[start:j] = [new_line]
                changed += 1
                j = start + 1

        i = j

    if changed:
        po_path.write_text('\n'.join(lines) + '\n', encoding='utf-8')
    return changed


def main() -> None:
    total = 0
    for lang, mapping in REMAINING_TRANSLATIONS.items():
        po = BASE / 'goflow' / 'locale' / lang / 'LC_MESSAGES' / 'django.po'
        if not po.exists():
            continue
        updated = apply_translations(po, mapping)
        if updated:
            print(f'{lang}: {updated}')
            total += updated
    print(f'total updated: {total}')


if __name__ == '__main__':
    main()